{% extends "base.html" %}

{% block content %}
  <h2>Schedule for "{{ plan.name }}"</h2>
  
  {% set badge_class = "bg-success" if status == "Optimal" else "bg-warning" %}
  <p>
    Solver status:
    <span class="badge {{ badge_class }}">{{ status }}</span>
  </p>

  <div class="mb-3">
    <a href="{{ url_for('main.view_plan', plan_id=plan.id) }}" class="btn btn-link">
      &larr; Back to plan
    </a>
    <a href="{{ url_for('main.plan_settings', plan_id=plan.id) }}" class="btn btn-outline-secondary btn-sm ms-2">
      Plan settings
    </a>
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary btn-sm ms-2">
      Dashboard
    </a>
  </div>

  {% set hints = infeasible_hints | default([]) %}

  {% if status != 'Optimal' %}
    <div class="alert alert-warning" role="alert">
      <div class="fw-semibold">No valid schedule could be produced.</div>
      <div class="mt-1">
        The solver couldn't find a feasible solution under your current offerings + settings.
      </div>

      {% if hints %}
        <ul class="mt-2 mb-2">
          {% for h in hints %}
            <li>{{ h }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      <div class="mt-2">
        <div class="fw-semibold mb-1">What to try next</div>
        <ul class="mb-0">
          <li>
            Review offerings and prerequisites in
            <a href="{{ url_for('main.view_plan', plan_id=plan.id) }}">the plan page</a>.
          </li>
          <li>
            Adjust total semesters / max credits / solver flags in
            <a href="{{ url_for('main.plan_settings', plan_id=plan.id) }}">Plan settings</a>.
          </li>
        </ul>
      </div>
    </div>
  {% else %}
    <div class="row">
      {% for sem in semesters %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-header">
              Semester {{ sem }}
            </div>
            <ul class="list-group list-group-flush">
              {% if courses_by_semester[sem] %}
                {% for course in courses_by_semester[sem] %}
                  <li class="list-group-item">
                    <strong>{{ course.code }}</strong> — {{ course.name }}<br>
                    <small>
                      Credits: {{ course.credits }}
                      {% if course.difficulty is not none %}
                        • Difficulty: {{ course.difficulty }}
                      {% endif %}
                    </small>
                  </li>
                {% endfor %}
              {% else %}
                <li class="list-group-item text-muted">
                  No courses scheduled in this semester.
                </li>
              {% endif %}
            </ul>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
