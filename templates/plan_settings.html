{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="mb-0">Plan settings</h2>

  <div class="text-end">
    <a
      href="{{ url_for('main.view_plan', plan_id=plan.id) }}"
      class="btn btn-outline-secondary btn-sm me-2"
    >
      &larr; Back to plan
    </a>

    <span class="btn btn-outline-secondary btn-sm me-2 disabled">
      Plan settings
    </span>

    <form
      method="POST"
      action="{{ url_for('main.solve_plan', plan_id=plan.id) }}"
      class="d-inline"
    >
      <button type="submit" class="btn btn-primary btn-sm">
        Solve schedule
      </button>
    </form>
  </div>
</div>


<div class="card">
  <div class="card-body">
    <form
      method="POST"
      action="{{ url_for('main.plan_settings', plan_id=plan.id) }}"
    >

      <!-- Schedule limits -->
      <h5 class="mb-3">Schedule limits</h5>

      <p class="text-muted small mb-4">
        Scheduling limits are controlled by <strong>Total semesters</strong> and <strong>Max credits per semester</strong>. <br>
        Plan structure below only changes labels.
      </p>

      <div class="row g-3">
        <!-- Total semesters -->
        <div class="col-md-6">
          <div class="border rounded p-3 bg-light h-100">
            <div class="d-flex justify-content-between align-items-start gap-3">
              <div>
                <label for="total_semesters" class="form-label mb-1">
                  Total semesters
                </label>
                <div class="form-text">
                  Controls how many semesters exist in the plan <br>
                  (and in the solver).
                </div>
              </div>

              <div class="text-end">
                <input
                  type="number"
                  class="form-control"
                  id="total_semesters"
                  name="total_semesters"
                  min="1"
                  max="20"
                  value="{{ constraints.total_semesters or 6 }}"
                  required
                  style="width: 140px;"
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Max credits per semester -->
        <div class="col-md-6">
          <div class="border rounded p-3 bg-light h-100">
            <div class="d-flex justify-content-between align-items-start gap-3">
              <div>
                <label for="max_credits_per_semester" class="form-label mb-1">
                  Max credits for a semester
                </label>
                <div class="form-text">
                  If left blank, no per-semester credit limit is enforced.
                </div>
              </div>

              <div class="text-end">
                <input
                  type="number"
                  class="form-control"
                  id="max_credits_per_semester"
                  name="max_credits_per_semester"
                  min="1"
                  max="60"
                  value="{{ constraints.max_credits_per_semester if constraints.max_credits_per_semester is not none else '' }}"
                  placeholder="No limit"
                  style="width: 140px;"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Plan structure (optional) -->
      <div class="border rounded p-3 bg-light mb-4">

        <h5 class="mb-3">Plan structure (optional)</h5>
        <p class="text-muted small mb-3">
          Used for display labels only (e.g. ⟨ Year 2 - Semester 1 ⟩ ). <br>
          Leave both fields blank to show semesters as a simple numbered list.
        </p>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="years" class="form-label">
              Number of years
            </label>
            <input
              type="number"
              class="form-control"
              id="years"
              name="years"
              min="1"
              max="10"
              value="{{ constraints.years if constraints and constraints.years is not none else '' }}"
              placeholder="e.g. 3"
            >
            <div class="form-text">
              Used only to group semesters visually by year.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="semesters_per_year" class="form-label">
              Semesters per year
            </label>
            <input
              type="number"
              class="form-control"
              id="semesters_per_year"
              name="semesters_per_year"
              min="1"
              max="6"
              value="{{ constraints.semesters_per_year if constraints and constraints.semesters_per_year is not none else '' }}"
              placeholder="e.g. 3"
            >
            <div class="form-text">
              Used only for display. <br>
              Example: some programs have 3 semesters in a year (including summer).
            </div>
          </div>
        </div>

      </div>
      <hr class="my-4">

      <!-- Solver flags -->
      <div class="border rounded p-3 bg-light mb-4">

        <h5 class="mb-3">Scheduling Options</h5>

        <div class="form-check mb-2">
          <input
            class="form-check-input"
            type="checkbox"
            id="enforce_prereqs"
            name="enforce_prereqs"
            {% if constraints and constraints.enforce_prereqs %}checked{% endif %}
          >
          <label class="form-check-label" for="enforce_prereqs">
            Enforce prerequisite rules
          </label>
        </div>

        <div class="form-check mb-2">
          <input
            class="form-check-input"
            type="checkbox"
            id="enforce_credit_limits"
            name="enforce_credit_limits"
            {% if constraints and constraints.enforce_credit_limits %}checked{% endif %}
          >
          <label class="form-check-label" for="enforce_credit_limits">
            Enforce credit limits per semester
          </label>

          <div class="form-text">
            Uses catalog prerequisites when they can be resolved, otherwise they appear as warnings.
          </div>
        </div>

        <div class="form-check mb-3">
          <input
            class="form-check-input"
            type="checkbox"
            id="minimize_last_semester"
            name="minimize_last_semester"
            {% if constraints and constraints.minimize_last_semester %}checked{% endif %}
          >
          <label class="form-check-label" for="minimize_last_semester">
            Prefer earlier completion when multiple schedules are valid
          </label>
        </div>
      </div>
      <!-- Settings Button -->
      <div class="d-flex justify-content-center mt-3">
        <button type="submit" class="btn btn-primary">
          Save settings
        </button>
      </div>

    </form>
  </div>
</div>

{% endblock %}
